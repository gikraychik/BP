/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
(function(w){function h(K,L,M){var N=this;return this.on("click.pjax",K,function(P){var O=w.extend({},I(L,M));if(!O.container){O.container=w(this).attr("data-pjax")||N}a(P,O)})}function a(P,L,M){M=I(L,M);var O=P.currentTarget;if(O.tagName.toUpperCase()!=="A"){throw"$.fn.pjax or $.pjax.click requires an anchor element"}if(P.which>1||P.metaKey||P.ctrlKey||P.shiftKey||P.altKey){return}if(location.protocol!==O.protocol||location.hostname!==O.hostname){return}if(O.href.indexOf("#")>-1&&t(O)==t(location)){return}if(P.isDefaultPrevented()){return}var Q={url:O.href,container:w(O).attr("data-pjax"),target:O};var N=w.extend({},Q,M);var K=w.Event("pjax:click");w(O).trigger(K,[N]);if(!K.isDefaultPrevented()){E(N);P.preventDefault();w(O).trigger("pjax:clicked",[N])}}function q(N,K,L){L=I(K,L);var M=N.currentTarget;if(M.tagName.toUpperCase()!=="FORM"){throw"$.pjax.submit requires a form element"}var O={type:M.method.toUpperCase(),url:M.action,container:w(M).attr("data-pjax"),target:M};if(O.type!=="GET"&&window.FormData!==undefined){O.data=new FormData(M);O.processData=false;O.contentType=false}else{if(w(M).find(":file").length){return}O.data=w(M).serializeArray()}E(w.extend({},O,L));N.preventDefault()}function E(K){K=w.extend(true,{},w.ajaxSettings,E.defaults,K);if(w.isFunction(K.url)){K.url=K.url()}var P=K.target;var O=o(K.url).hash;var L=K.context=x(K.container);if(!K.data){K.data={}}if(w.isArray(K.data)){K.data.push({name:"_pjax",value:L.selector})}else{K.data._pjax=L.selector}function N(T,R,S){if(!S){S={}}S.relatedTarget=P;var U=w.Event(T,S);L.trigger(U,R);return !U.isDefaultPrevented()}var M;K.beforeSend=function(T,S){if(S.type!=="GET"){S.timeout=0}T.setRequestHeader("X-PJAX","true");T.setRequestHeader("X-PJAX-Container",L.selector);if(!N("pjax:beforeSend",[T,S])){return false}if(S.timeout>0){M=setTimeout(function(){if(N("pjax:timeout",[T,K])){T.abort("timeout")}},S.timeout);S.timeout=0}var R=o(S.url);if(O){R.hash=O}K.requestUrl=k(R)};K.complete=function(R,S){if(M){clearTimeout(M)}N("pjax:complete",[R,S,K]);if(K.from=="form"){N("pjax:form:end",[R,K])}else{N("pjax:end",[R,K])}};K.error=function(U,V,S){var R=u("",U,K);var T=N("pjax:error",[U,V,S,K]);if(K.type=="GET"&&V!=="abort"&&T){p(R.url)}};K.success=function(V,U,ac){var Y=E.state;var ab=(typeof w.pjax.defaults.version==="function")?w.pjax.defaults.version():w.pjax.defaults.version;var ad=ac.getResponseHeader("X-PJAX-Version");var T=u(V,ac,K);var S=o(T.url);if(O){S.hash=O;T.url=S.href}if(ab&&ad&&ab!==ad){p(T.url);return}if(!T.contents){p(T.url);return}E.state={id:K.id||f(),url:T.url,title:T.title,container:L.selector,fragment:K.fragment,timeout:K.timeout};if(K.push||K.replace){window.history.replaceState(E.state,T.title,T.url)}try{document.activeElement.blur()}catch(aa){}if(T.title){document.title=T.title}N("pjax:beforeReplace",[T.contents,K],{state:E.state,previousState:Y});L.html(T.contents);var X=L.find("input[autofocus], textarea[autofocus]").last()[0];if(X&&document.activeElement!==X){X.focus()}v(T.scripts);var W=K.scrollTo;if(O){var R=decodeURIComponent(O.slice(1));var Z=document.getElementById(R)||document.getElementsByName(R)[0];if(Z){W=w(Z).offset().top}}if(typeof W=="number"){w(window).scrollTop(W)}N("pjax:success",[V,U,ac,K])};if(!E.state){E.state={id:f(),url:window.location.href,title:document.title,container:L.selector,fragment:K.fragment,timeout:K.timeout};window.history.replaceState(E.state,document.title)}J(E.xhr);E.options=K;var Q=E.xhr=w.ajax(K);if(Q.readyState>0){if(K.push&&!K.replace){y(E.state.id,d(L));window.history.pushState(null,"",K.requestUrl)}N("pjax:start",[Q,K]);N("pjax:send",[Q,K])}return E.xhr}function A(K,L){var M={url:window.location.href,push:false,replace:true,scrollTo:false};return E(w.extend(M,I(K,L)))}function p(K){window.history.replaceState(null,"",E.state.url);window.location.replace(K)}var s=true;var C=window.location.href;var D=window.history.state;if(D&&D.container){E.state=D}if("state" in window.history){s=false}function z(L){var K=E.state;var M=L.state;var N;if(M&&M.container){if(s&&C==M.url){return}if(K){if(K.id===M.id){return}N=K.id<M.id?"forward":"back"}}return N}function b(M){if(!s){J(E.xhr)}var R=E.state;var L=M.state;var S;if(L&&L.container){if(s&&C==L.url){return}if(R){if(R.id===L.id){return}S=R.id<L.id?"forward":"back"}var K=H[L.id]||[];var N=w(K[0]||L.container),P=K[1];if(N.length){if(R){n(S,R.id,d(N))}var Q=w.Event("pjax:popstate",{state:L,direction:S});N.trigger(Q);var T={id:L.id,url:L.url,container:N,push:false,fragment:L.fragment,timeout:L.timeout,scrollTo:false};if(P){N.trigger("pjax:start",[null,T]);E.state=L;if(L.title){document.title=L.title}var O=w.Event("pjax:beforeReplace",{state:L,previousState:R});N.trigger(O,[P,T]);N.html(P);N.trigger("pjax:end",[null,T])}else{E(T)}N[0].offsetHeight}else{p(location.href)}}s=false}function e(L){var K=w.isFunction(L.url)?L.url():L.url,P=L.type?L.type.toUpperCase():"GET";var N=w("<form>",{method:P==="GET"?"GET":"POST",action:K,style:"display:none"});if(P!=="GET"&&P!=="POST"){N.append(w("<input>",{type:"hidden",name:"_method",value:P.toLowerCase()}))}var O=L.data;if(typeof O==="string"){w.each(O.split("&"),function(Q,R){var S=R.split("=");N.append(w("<input>",{type:"hidden",name:S[0],value:S[1]}))})}else{if(w.isArray(O)){w.each(O,function(Q,R){N.append(w("<input>",{type:"hidden",name:R.name,value:R.value}))})}else{if(typeof O==="object"){var M;for(M in O){N.append(w("<input>",{type:"hidden",name:M,value:O[M]}))}}}}w(document.body).append(N);N.submit()}function J(K){if(K&&K.readyState<4){K.onreadystatechange=w.noop;K.abort()}}function f(){return(new Date).getTime()}function d(L){var K=L.clone();K.find("script").each(function(){if(!this.src){jQuery._data(this,"globalEval",false)}});return[L.selector,K.contents()]}function k(K){K.search=K.search.replace(/([?&])(_pjax|_)=[^&]*/g,"");return K.href.replace(/\?($|#)/,"$1")}function o(L){var K=document.createElement("a");K.href=L;return K}function t(K){return K.href.replace(/#.*/,"")}function I(K,L){if(K&&L){L.container=K}else{if(w.isPlainObject(K)){L=K}else{L={container:K}}}if(L.container){L.container=x(L.container)}return L}function x(K){K=w(K);if(!K.length){throw"no pjax container for "+K.selector}else{if(K.selector!==""&&K.context===document){return K}else{if(K.attr("id")){return w("#"+K.attr("id"))}else{throw"cant get selector for pjax container!"}}}}function r(L,K){return L.filter(K).add(L.find(K))}function i(K){return w.parseHTML(K,document,true)}function u(O,Q,S){var N={},K=/<html/i.test(O);var L=Q.getResponseHeader("X-PJAX-URL");N.url=L?k(o(L)):S.requestUrl;if(K){var P=w(i(O.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0]));var M=w(i(O.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))}else{var P=M=w(i(O))}if(M.length===0){return N}N.title=r(P,"title").last().text();if(S.fragment){if(S.fragment==="body"){var R=M}else{var R=r(M,S.fragment).first()}if(R.length){N.contents=S.fragment==="body"?R:R.contents();if(!N.title){N.title=R.attr("title")||R.data("title")}}}else{if(!K){N.contents=M}}if(N.contents){N.contents=N.contents.not(function(){return w(this).is("title")});N.contents.find("title").remove();N.scripts=r(N.contents,"script[src]").remove();N.contents=N.contents.not(N.scripts)}if(N.title){N.title=w.trim(N.title)}return N}function v(K){if(!K){return}var L=w("script[src]");K.each(function(){var O=this.src;var P=L.filter(function(){return this.src===O});if(P.length){return}var M=document.createElement("script");var N=w(this).attr("type");if(N){M.type=N}M.src=w(this).attr("src");document.head.appendChild(M)})}var H={};var B=[];var l=[];function y(L,K){H[L]=K;l.push(L);j(B,0);j(l,E.defaults.maxCacheLength)}function n(M,O,L){var N,K;H[O]=L;if(M==="forward"){N=l;K=B}else{N=B;K=l}N.push(O);if(O=K.pop()){delete H[O]}j(N,E.defaults.maxCacheLength)}function j(K,L){while(K.length>L){delete H[K.shift()]}}function F(){return w("meta").filter(function(){var K=w(this).attr("http-equiv");return K&&K.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function g(){w.fn.pjax=h;w.pjax=E;w.pjax.enable=w.noop;w.pjax.disable=c;w.pjax.click=a;w.pjax.submit=q;w.pjax.reload=A;w.pjax.navigation=b;w.pjax.enablePopstateHandle=G;w.pjax.disablePopstateHandle=m;w.pjax.getNavDirection=z;w.pjax.defaults={timeout:5000,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:F}}function G(){w(window).on("popstate.pjax",b)}function m(){w(window).off("popstate.pjax",b)}function c(){w.fn.pjax=function(){return this};w.pjax=e;w.pjax.enable=g;w.pjax.disable=w.noop;w.pjax.click=w.noop;w.pjax.submit=w.noop;w.pjax.reload=function(){window.location.reload()}}if(w.inArray("state",w.event.props)<0){w.event.props.push("state")}w.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);w.support.pjax?g():c()})(jQuery);
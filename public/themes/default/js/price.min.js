(function(x,g,h){const e="price";const s="#"+e;const i=30;const o="checked-sale";const f="disabled-sale";const l="."+o;const t=".item a";var k;var q;var w;var c;var d;var p;var b=true;elementsCallbackStack.addPageCb(n);function n(){if(!(g("body").attr("id")==e)){return}var y=g(t).map(function(A,B){return new r(g(B),A)});k=new j(y);k.updateLocation(g(window).width());for(var z=k.saleList.length-1;z>=0;z--){k.updateIncludes(k.saleList[z]);k.updateExcludes(k.saleList[z])}k.updatePrice();if(typeof q=="undefined"){q=new PopupWindow("#popup","#order",s);q.init()}if(typeof d=="undefined"){d=new Form("#order-form");d.afterSubmitFunctions.push(q.close.bind(q));q.functionsOnHide.push(function(){d.$resultContainer.fadeOut()})}else{d.reinit(d.formId)}d.initDateFields();d.initTimeFields();if(typeof w=="undefined"){w=new PopupWindow("#popup-info","#info-button",s);w.init()}if(typeof c=="undefined"){c=new PopupWindow("#popup-promo",".promo-button",s);c.init()}if(typeof p=="undefined"){p=new Form("#promo-form");p.afterSubmitFunctions.push(function(){k.promo.isActive=true;k.promo.checkPromo(k.getSaleByDomElem(g(".promo-button")));k.promo.isUsed=true;k.updatePrice()}.bind(k));p.beforeSubmitFunctions.push(function(){p.$form.find("button").wait();b=false}.bind(k));p.afterSubmitFunctions.push(c.close.bind(c));c.functionsOnHide.push(function(){p.$resultContainer.fadeOut()})}else{p.reinit(p.formId)}g(".hasTooltip").each(function(){g(this).qtip({content:{text:g(this).next("div").html()},style:{classes:"qtip-bootstrap qtip-shadow text"},position:{my:"top center",at:"bottom center",adjust:{method:"shift shift"},viewport:g(document)}})});if(!g_loadedOnce){setContentInVerticalMiddle()}}elementsCallbackStack.addOnPjaxReplaceCb(function(){if(!(g("body").attr("id")==e)){return}var y=(PAGE_ANIMATION=="move");setContentInVerticalMiddle(y)});elementsCallbackStack.addFormCb(u);function u(){if(!(g("body").attr("id")==e)){return}d.afterSubmit();p.afterSubmit();p.$form.find("button").unwait();b=true}elementsCallbackStack.addOnResizeCb(v);function v(z,y){if(!(g("body").attr("id")==e)){return}k.updateLocation(z);setContentInVerticalMiddle()}elementsCallbackStack.addBeforePjaxSendCb(function(){if(!(g("body").attr("id")==e)){return}if(b){startPageLoader(PAGE_LOADER_FIRST_RGBA);startPageLoaderTimer(PAGE_LOADER_SECOND_RGBA,PAGE_LOADER_DELAY)}});g(document).on("click",s+" .item a",function(z){z.preventDefault();var y=g(this);var A=k.getSaleByDomElem(y);if(A.isDisabled){return}if(!A.isSelected){A.select()}else{A.unselect()}k.saleList.each(function(){k.updateIncludes(this);k.updateExcludes(this);k.udpateOverflowSales()});k.updatePrice();var B=new Form()});g(document).on("click","input[name=hours]",function(){for(var y=k.saleList.length-1;y>=0;y--){k.updateIncludes(k.saleList[y])}k.udpateOverflowSales();k.updatePrice()});function j(y){this.saleList=y;this.hours=new a();this.promo=new m();this.fixPrice=parseInt(g("#fix-price").html());this.$elem=g("#price-calc");this.location="down"}j.prototype.getSaleByDomElem=function(y){return this.saleList[this.getSaleIndexByDomElem(y)]};j.prototype.getSaleIndexByDomElem=function(y){var z=y.parent();return g("."+z.attr("class")).index(z)};j.prototype.getSaleById=function(z){for(var y=this.saleList.length-1;y>=0;y--){if(this.saleList[y].id==z){return this.saleList[y]}}};j.prototype.checkHours=function(A,B){var y=B.split("#");var C=y[1].split("-")[0];var z=parseInt(y[1].split("-")[1]);if(C=="more"){if(this.hours.getValue()<z){A.disableBy(B)}else{A.enableBy(B)}}else{if(C=="less"){if(this.hours.getValue()>z){A.disableBy(B)}else{A.enableBy(B)}}}};j.prototype.updateIncludes=function(z){if(z.includes.length>0){for(var y=z.includes.length-1;y>=0;y--){if(this.hours.isHoursId(z.includes[y])){this.checkHours(z,z.includes[y]);continue}if(this.promo.isPromoId(z.includes[y])){if(!this.promo.isUsed){if(!z.isDisabled){this.promo.setPromoHandler(z)}else{this.promo.removePromoHandler(z)}this.promo.checkPromo(z)}continue}var A=this.getSaleById(z.includes[y]);if(!A.isSelected){z.disableBy(A.index)}else{z.enableBy(A.index)}}}};j.prototype.updateExcludes=function(A){if(A.excludes.length>0){for(var y=A.excludes.length-1;y>=0;y--){var z=this.getSaleById(A.excludes[y]);if(A.isSelected){z.disableBy(A.index)}else{z.enableBy(A.index)}}}};j.prototype.udpateOverflowSales=function(){var y="overflow";for(var z=this.saleList.length-1;z>=0;z--){if(this.isSaleMax(this.saleList[z])&&!this.saleList[z].isSelected){this.saleList[z].disableBy(y)}else{this.saleList[z].enableBy(y)}}};j.prototype.isSaleMax=function(z){var y=z.value+this.getSalesSum();return y>i};j.prototype.getSalesSum=function(){var y=0;for(var z=this.saleList.length-1;z>=0;z--){if(this.saleList[z].isSelected){y+=this.saleList[z].value}}return y>i?i:y};j.prototype.getSum=function(){var z=this.getSalesSum()/100;var y=this.hours.getValue();return Math.round(this.fixPrice*y-z*this.fixPrice*y)};j.prototype.updatePrice=function(){var z=this.getSum();var C=this.getSalesSum();var y=this.hours.getValue();g(s+" #sum").html(z);g(s+" #sum-field").val(z);g(s+" #sum-sale").html(C);g(s+" #sale-field").val(C);g(s+" #mult").html(y);g(s+" #hours-field").val(y);var B="";var A=g(l).length;g(l).each(function(D){B+=g(this).parent().children("span").html()+(A!=D+1&&A!=1?", ":".")});g(s+" #checked-sales-field").val(B.toLowerCase())};j.prototype.updateLocation=function(y){if(Modernizr.mq("(max-width: 1200px)")&&k.location=="down"){k.moveUp();k.location="up"}else{if(!Modernizr.mq("(max-width: 1200px)")&&k.location=="up"){k.moveDown();k.location="down"}}};j.prototype.moveUp=function(){g("#price-calc-up").append(this.$elem)};j.prototype.moveDown=function(){g("#price-calc-down").append(this.$elem)};function r(B,y){this.index=y;this.id="";this.sale=B;this.includes=[];this.excludes=[];this.saleParent=this.sale.parent();this.disabledBy=[];this.isSelected=false;this.isDisabled=false;this.value=parseInt(this.sale.find("#sale").html());var A=this.saleParent.attr("id");if(A){this.id=A}var z=this.saleParent.attr("includes");if(z){this.includes=z.split(" ")}var C=this.saleParent.attr("excludes");if(C){this.excludes=C.split(" ")}}r.prototype.disable=function(){this.unselect();this.sale.addClass(f);this.isDisabled=true};r.prototype.disableBy=function(y){this.disable();if(!this.isDisabledBy(y)){this.disabledBy.push(y)}};r.prototype.isDisabledBy=function(y){var z=g.inArray(y,this.disabledBy);return z>-1};r.prototype.popDisable=function(y){var z=g.inArray(y,this.disabledBy);if(z>-1){this.disabledBy.splice(z,1)}};r.prototype.enable=function(){this.sale.removeClass(f);this.isDisabled=false};r.prototype.enableBy=function(y){if(this.isDisabledBy(y)){this.popDisable(y);if(this.disabledBy.length==0){this.enable()}}};r.prototype.select=function(){this.sale.addClass(o);this.isSelected=true};r.prototype.unselect=function(){this.sale.removeClass(o);this.isSelected=false};function a(){}a.prototype.getValue=function(y){return g("input[name=hours]:checked").val()};a.prototype.isHoursId=function(z){var y=z.split("#");return y.length>1};function m(){this.isUsed=false;this.isActive=false}m.prototype.isPromoId=function(y){return y=="promo"};m.prototype.checkPromo=function(y){if(this.isActive){y.select();this.removePromoHandler(y)}else{y.unselect()}};m.prototype.setPromoHandler=function(y){if(!y.sale.hasClass("promo-button")){y.sale.addClass("promo-button")}};m.prototype.removePromoHandler=function(y){if(y.sale.hasClass("promo-button")){y.sale.removeClass("promo-button")}}}(window.pricePage=window.pricePage||{},jQuery));
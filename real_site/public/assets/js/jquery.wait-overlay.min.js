(function(c){var b={title:"",text:"",extraCssClasses:[],overrideGeometry:{top:undefined,left:undefined,width:undefined,height:undefined}};var a=function(d,e){this._waitCount=0;this._parent=d;this._options=c.extend({},b,e)};a.prototype={get waitCount(){return this._waitCount},show:function(){if(this._waitCount++){return}this._buildAndDisplay();this._parent.data("waitOverlay",this)},unshow:function(){if(--this._waitCount===0){this._removeSelf()}},_buildAndDisplay:function(){var d=this;this._createOverlay()._addTitle()._addText()._addWaitClassArea()._waitForParentToStabilize().done(function(){d._display()})},_createOverlay:function(){return this._parentIsWindow()?this._createWindowOverlay():this._createRegularOverlay()},_createWindowOverlay:function(){this._overlay=c("<div></div>").css("position","fixed").css("display","table").css("z-index","9999").css("width","100%").css("height","100%").css("top","0").css("left","0").css("margin-left","0").css("margin-top","0").addClass("wait-overlay").addClass("wait-overlay-window");this._ensureOverlayIsNotTransparent();this._applyExtraCssClassesTo(this._overlay);return this},_createRegularOverlay:function(){var e=c(this._parent);var f=e.position();var d=this._getMarginsOf(e);this._overlay=c("<div></div>").css("position","absolute").css("display","table").css("z-index","9999").width(e.outerWidth()).height(e.outerHeight()).css("left",f.left).css("top",f.top).css(d).addClass("wait-overlay");this._applyExtraCssClassesTo(this._overlay);return this},_getMarginsOf:function(d){return{marginLeft:d.css("margin-left"),marginRight:d.css("margin-right"),marginTop:d.css("margin-top"),marginBottom:d.css("margin-bottom")}},_applyExtraCssClassesTo:function(d){this._options.extraCssClasses.forEach(function(e){d.addClass(e)})},_getParentGeometry:function(){if(this._options.overrideGeometry){return this._options.overrideGeometry}var d=c(this._parent).offset();return{left:d.left,top:d.top,width:c(this._parent).outerWidth(),height:c(this._parent).outerHeight(),marginLeft:c(this._parent).css("margin-left"),marginRight:c(this._parent).css("margin-right")}},_addWaitClassArea:function(){var e=c("<div></div>").addClass("wait");var d=c("<div></div>").addClass("wait-lens");var f=c("<div></div>");f.append(e);f.append(d);this._overlay.append(f);this._waitArea=f;return this},_addTitle:function(){if(this._options.title){var e=c("<div></div>").css("text-align","center").css("margin","0px").addClass("wait-title-container");var d=c("<span></span>").css("margin","0px").text(this._options.title).addClass("wait-title");e.append(d);this._titleArea=e;this._overlay.append(e)}return this},_addText:function(){if(this._options.text){var e=c("<div></div>").addClass("wait-text-container").css("margin","0px").css("width","100%");var d=c("<span></span>").text(this._options.text).css("white-space","pre-wrap").addClass("wait-text");e.append(d);this._textArea=e;this._overlay.append(e)}return this},_display:function(){if(this._parentIsWindow()){c("body").append(this._overlay)}else{c(this._parent.parent()).append(this._overlay)}this._keepSizeInSync()},_checkIfParentHasStabilised:function(g,f){if(!this._waitCount){g.reject()}var h=this._getParentGeometry();var i=(f===undefined);if(!i){for(var e in h){if(h[e]!==f[e]){i=true;break}}}if(i){var d=this;window.setTimeout(function(){d._checkIfParentHasStabilised(g,h)},50);return}g.resolve(h)},_waitForParentToStabilize:function(){var d=new c.Deferred();this._checkIfParentHasStabilised(d);return d.promise()},_keepSizeInSync:function(){if(this._parent.is(":visible")){var f=(this._parent.parent&&this._parent.parent())||this._parent;if(f.length===0){f=c("html")}if(f.find(".wait-overlay").length){var e=this._resizeInnerContentToFit();var d=this;window.setTimeout(function(){d._keepSizeInSync(true)},e?25:100)}}},_resizeInnerContentToFit:function(){var d=false;if(this._textArea){d=this._resizedTextArea()}else{d=this._resizedWaitArea()}return d},_resizedWaitArea:function(){var d=this._waitArea.height();var e=this._getParentHeight();if(this._titleArea){e-=this._titleArea.outerHeight()}if(d!==e){this._waitArea.height(e);return true}return false},_resizedTextArea:function(){var d=this._textArea.height();var e=this._getParentHeight()-this._waitArea.outerHeight();if(this._titleArea){e-=this._titleArea.outerHeight()}if(d!==e){this._textArea.height(e);return true}return false},_parentIsWindow:function(){return this._parent[0]===window},_createBackingOverlay:function(){if(this._parentIsWindow()){return}this._backingOverlay=c(this._parent).clone();this._backingOverlay.addClass("wait-overlay-backing").css("opacity",this._options.backingOverlayOpacity);c(this._backingOverlay).find("*").attr("disabled","disabled");c(this._parent.parent()).append(this._backingOverlay);this._parent.hide()},_removeSelf:function(){this._parent.data("waitOverlay",null);this._overlay.remove();if(this._backingOverlay){this._backingOverlay.remove()}this._parent.show()},_getParentWidth:function(){var j=this._parent.width();var e=this._parent.offset().left;var h=e+j;var g=this._parent.find("*:visible");var k,d;for(var f=0;f<g.length;f++){k=c(g[f]).offset().left;d=k+c(g[f]).width();d+=this._getCssIntVal(g[f],"padding-left");d+=this._getCssIntVal(g[f],"padding-right");if(d>h){h=d}}return h-e},_getParentHeight:function(){if(this._options.overrideGeometry.height!==undefined){return this._options.overrideGeometry.height}var d=this._parent.height();var j=this._parent.offset().top;var h=j+d;var g=this._parent.find("*:visible");var k,e;for(var f=0;f<g.length;f++){k=c(g[f]).offset().top;e=k+c(g[f]).height();e+=this._getCssIntVal(g[f],"padding-top");e+=this._getCssIntVal(g[f],"padding-bottom");if(e>h){h=e}}return h-j},_getCssIntVal:function(d,h){var g=c(d).css(h);if(!g){return 0}g=g.replace(/px/,"");try{return parseInt(g,10)}catch(f){return 0}}};c.fn.wait=function(e){var d=new c.Deferred();if(this.length===0){return d.promise()}e=e||{};for(var f=0;f<this.length;f++){var g=this[f];if(g===window){e.overrideGeometry={left:0,top:0,width:window.innerWidth,height:window.innerHeight}}var h=c(g).data("waitOverlay");var j=h||new a(c(g),e);j.show()}return d.promise()};c.fn.unwait=function(){for(var d=0;d<this.length;d++){var e=c(this.get(d));var f=e.data("waitOverlay");if(f){f.unshow()}}};window.TestExports=window.TestExports||{};window.TestExports=c.extend({},window.TestExports,{WaitOverlay:a});if(window.jasmine){a.prototype._waitForParentToStabilize=function(){var d=new c.Deferred();d.resolve({});return d.promise()}}})(jQuery);